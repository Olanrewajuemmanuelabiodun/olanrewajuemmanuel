import os
import re
import json

def extract_total_energy(file_path):
    try:
        with open(file_path, 'r') as file:
            content = file.read()
            match = re.search(r'totalenergy\s+(-?\d+\.\d+)', content)
            if match:
                return float(match.group(1))
            else:
                return None
    except FileNotFoundError:
        return None

# Replace this with the path to your main directory
main_directory = '/Users/eolanrew/Desktop/Most_stable_T_site_Direct_Al_H'

# Initialize an empty dictionary to store the results
data = {}

# Loop through each folder in the main directory
for folder_name in sorted(os.listdir(main_directory)):
    folder_path = os.path.join(main_directory, folder_name)
    
    # Check if it's a folder
    if os.path.isdir(folder_path):
        prefix = folder_name[:3]  # Assuming the first three characters are common, like "ABW"
        
        # Initialize the dictionary for this prefix if not already done
        if prefix not in data:
            data[prefix] = {}
        
        # Look for the .gout file in this folder
        for file_name in sorted(os.listdir(folder_path)):
            if file_name.endswith('.gout'):
                file_path = os.path.join(folder_path, file_name)
                total_energy = extract_total_energy(file_path)
                
                if total_energy is not None:
                    data[prefix][folder_name] = total_energy

# Save the results to a JSON file
json_file_path = 'Most_stable_T_site_Direct_Al_H.json'  # Replace this with your desired path
with open(json_file_path, 'w') as json_file:
    json.dump(data, json_file, indent=4, sort_keys=True)

print(f"Data has been saved to {json_file_path}")
